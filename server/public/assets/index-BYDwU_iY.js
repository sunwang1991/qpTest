import{d as ll,r as g,I as pe,aB as tl,aC as al,B as me,C as ol,V as nl,N as sl,e as ul,W as dl,c as S,o as u,f as t,w as o,h as w,E as rl,J as K,k as a,K as b,n as fe,Q as il,S as D,T as P,i as d,R as pl,q as ml,p as v,X as ce,j as y,aU as q,Y as fl,t as ge,Z as cl,L as gl,$ as _l,A as _e}from"./index-koRf1amC.js";/* empty css                   */import{E as vl,u as bl}from"./file-De-QCupv.js";import{E as yl}from"./el-link-D2SH8ong.js";import{E as kl}from"./el-checkbox-HK0N5oFI.js";import{E as wl}from"./el-dialog-BKcY_UO0.js";import{E as hl,b as Vl}from"./el-radio-BeFAM8_7.js";import{E as xl}from"./el-tree-GdsLcPzm.js";import{E as Il}from"./el-tree-select-BH3iJm58.js";import{_ as Ul}from"./index-CSO0AOC1.js";import{E as El,a as Nl}from"./el-table-column-r1ysCLPE.js";import{_ as Cl}from"./index-C7JIz0oM.js";import{E as Sl}from"./el-row-VKr6Yz4y.js";import{_ as Fl}from"./index-CWBHHNWa.js";import{a as Rl,E as Tl}from"./el-form-item-BLvtEj0w.js";import{E as $l}from"./el-date-picker-BzY-SmTT.js";import{E as Dl}from"./el-col-BsYUv868.js";import{d as Pl,l as ql,a as ve,b as Bl,c as Ll,r as Ol,u as Kl,e as Ml,f as zl,i as Ql}from"./user-VNELyeO7.js";import"./_baseClone-VCTtEV7x.js";import"./index-BaLWcWe0.js";const Al={class:"app-container"},Yl={class:"head-container"},jl={class:"head-container"},Gl={class:"dialog-footer"},Hl={class:"el-upload__tip text-left"},Jl={class:"el-upload__tip"},Wl={class:"dialog-footer"},yt={__name:"index",setup(Xl){const{proxy:p}=ll(),{sys_normal_disable:M,sys_user_sex:be}=p.useDict("sys_normal_disable","sys_user_sex"),X=g([]),V=g(!1),z=g(!0),B=g(!0),Q=g([]),Z=g(!0),ee=g(!0),A=g(0),Y=g(""),F=g([]),L=g(""),j=g([]),ye=g(""),G=g([]),H=g([]),c=pe({open:!1,title:"",isUploading:!1,updateSupport:!1,msg:""}),x=g([{key:0,label:"用户编号",visible:!0},{key:1,label:"登录账号",visible:!0},{key:2,label:"用户昵称",visible:!0},{key:3,label:"部门",visible:!0},{key:4,label:"手机号码",visible:!0},{key:5,label:"状态",visible:!0},{key:6,label:"登录时间",visible:!0}]),ke=pe({form:{},queryParams:{pageNum:1,pageSize:20,userName:"",phone:"",statusFlag:void 0,deptId:100},rules:{userName:[{required:!0,message:"登录账号不能为空",trigger:"blur"},{pattern:ol,message:"账号只能包含大写小写字母，数字，且不少于4位",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{pattern:me,message:"密码至少包含大小写字母、数字、特殊符号，且不少于6位",trigger:"blur"}],email:[{pattern:al,message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phone:[{pattern:tl,message:"请输入正确的手机号码",trigger:"blur"}]}}),{queryParams:m,form:s,rules:we}=nl(ke),he=(n,e)=>n?e.label.indexOf(n)!==-1:!0;sl(L,n=>{p.$refs.deptTreeRef.filter(n)});function Ve(){Pl().then(n=>{j.value=n.data})}function I(){z.value=!0,ql(p.addDateRange(m.value,F.value)).then(n=>{z.value=!1,X.value=n.data.rows,A.value=n.data.total})}function xe(n){m.value.deptId=n.id,R()}function R(){m.value.pageNum=1,I()}function Ie(){F.value=[],p.resetForm("queryRef"),m.value.deptId=void 0,p.$refs.deptTreeRef.setCurrentKey(null),R()}function le(n){const e=n.userId||Q.value;p.$modal.confirm('是否确认删除用户编号为"'+e+'"的数据项？').then(function(){return Bl(e)}).then(()=>{I(),p.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Ue(){p.download("system/user/export",{...m.value},`user_${new Date().getTime()}.xlsx`)}function Ee(n){c.isUploading=!0;let e=new FormData;e.append("file",n.file,n.file.name),e.append("subPath","import"),bl(e).then(r=>r.data?r.data.filePath:"").then(r=>{if(r!=="")return Ql(r,c.updateSupport)}).then(r=>{var i;if(r===void 0)return;const E=(i=r.msg)==null?void 0:i.replaceAll(/<br\/>+/g,"\r");De(E,n.file)}).finally(()=>{c.isUploading=!1})}function Ne(n){let e=n.statusFlag==="1"?"启用":"停用";p.$modal.confirm('确认要"'+e+'""'+n.userName+'"用户吗?').then(function(){return Ll(n.userId,n.statusFlag)}).then(()=>{p.$modal.msgSuccess(e+"成功")}).catch(function(){n.statusFlag=n.statusFlag==="1"?"0":"1"})}function Ce(n){p.$modal.confirm('是否确认解锁用户"'+n+'"数据项?').then(function(){return Kl(n)}).then(()=>{p.$modal.msgSuccess("用户"+n+"解锁成功")}).catch(()=>{})}function Se(n){_e.prompt('请输入"'+n.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:me,inputErrorMessage:"密码至少包含大小写字母、数字、特殊符号，且不少于6位"}).then(({value:e})=>{Ol(n.userId,e).then(r=>{p.$modal.msgSuccess("修改成功，新密码是："+e)})}).catch(()=>{})}function Fe(n){Q.value=n.map(e=>e.userId),Z.value=n.length!=1,ee.value=!n.length}function Re(){c.title="用户导入",c.open=!0}function Te(){p.download("system/user/import/template",{},`user_template_${new Date().getTime()}.xlsx`)}const $e=(n,e,r)=>{c.isUploading=!0},De=(n,e)=>{c.open=!1,c.isUploading=!1,p.$refs.uploadRef.handleRemove(e),_e.alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+n+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),I()};function Pe(){p.$refs.uploadRef.submit()}function J(){s.value={userId:void 0,deptId:100,userName:"",nickName:"",password:"",phone:"",email:"",sex:"0",statusFlag:"0",remark:"",postIds:[],roleIds:[]},p.resetForm("userRef")}function qe(){V.value=!1,J()}function Be(){J(),ve().then(n=>{const{posts:e,roles:r}=n.data;G.value=e,H.value=r,V.value=!0,Y.value="添加用户",m.value.deptId?s.value.deptId=m.value.deptId:s.value.deptId=100,s.value.password=ye.value})}function te(n){J();const e=n.userId||Q.value;ve(e).then(r=>{const{user:E,posts:i,roles:f,postIds:N,roleIds:C}=r.data;E.password="",E.dept=void 0,s.value=E,G.value=i,H.value=f,s.value.postIds=N,s.value.roleIds=C,V.value=!0,Y.value="修改用户"})}function Le(){p.$refs.userRef.validate(n=>{n&&(s.value.userId?Ml(s.value).then(e=>{p.$modal.msgSuccess("修改成功"),V.value=!1,I()}):zl(s.value).then(e=>{p.$modal.msgSuccess("新增成功"),V.value=!1,I()}))})}return Ve(),I(),(n,e)=>{const r=rl,E=xl,i=Dl,f=Tl,N=pl,C=il,Oe=$l,_=ml,ae=Rl,Ke=Fl,U=Sl,h=Nl,Me=fl,ze=Cl,O=cl,Qe=El,Ae=Ul,Ye=Il,je=Vl,Ge=hl,oe=wl,He=ul("upload-filled"),Je=_l,We=kl,Xe=yl,Ze=vl,k=dl("hasPermi"),el=gl;return u(),S("div",Al,[t(U,{gutter:20},{default:o(()=>[t(i,{span:4,xs:24},{default:o(()=>[w("div",Yl,[t(r,{modelValue:a(L),"onUpdate:modelValue":e[0]||(e[0]=l=>K(L)?L.value=l:null),placeholder:"请输入部门名称",clearable:"","prefix-icon":"Search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),w("div",jl,[t(E,{data:a(j),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":he,ref:"deptTreeRef","node-key":"id","highlight-current":"","default-expand-all":"",onNodeClick:xe},null,8,["data"])])]),_:1}),t(i,{span:20,xs:24},{default:o(()=>[b(t(ae,{model:a(m),ref:"queryRef",inline:!0,"label-width":"68px"},{default:o(()=>[t(f,{label:"登录账号",prop:"userName"},{default:o(()=>[t(r,{modelValue:a(m).userName,"onUpdate:modelValue":e[1]||(e[1]=l=>a(m).userName=l),placeholder:"请输入登录账号",clearable:"",style:{width:"240px"},onKeyup:fe(R,["enter"])},null,8,["modelValue"])]),_:1}),t(f,{label:"手机号码",prop:"phone"},{default:o(()=>[t(r,{modelValue:a(m).phone,"onUpdate:modelValue":e[2]||(e[2]=l=>a(m).phone=l),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:fe(R,["enter"])},null,8,["modelValue"])]),_:1}),t(f,{label:"状态",prop:"statusFlag"},{default:o(()=>[t(C,{modelValue:a(m).statusFlag,"onUpdate:modelValue":e[3]||(e[3]=l=>a(m).statusFlag=l),placeholder:"用户状态",clearable:"",style:{width:"240px"}},{default:o(()=>[(u(!0),S(D,null,P(a(M),l=>(u(),d(N,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"登录时间",style:{width:"308px"}},{default:o(()=>[t(Oe,{modelValue:a(F),"onUpdate:modelValue":e[4]||(e[4]=l=>K(F)?F.value=l:null),type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),t(f,null,{default:o(()=>[t(_,{type:"primary",icon:"Search",onClick:R},{default:o(()=>e[23]||(e[23]=[v("搜索")])),_:1}),t(_,{icon:"Refresh",onClick:Ie},{default:o(()=>e[24]||(e[24]=[v("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[ce,a(B)]]),t(U,{gutter:10,class:"mb8"},{default:o(()=>[t(i,{span:1.5},{default:o(()=>[b((u(),d(_,{type:"primary",plain:"",icon:"Plus",onClick:Be},{default:o(()=>e[25]||(e[25]=[v("新增")])),_:1})),[[k,["system:user:add"]]])]),_:1}),t(i,{span:1.5},{default:o(()=>[b((u(),d(_,{type:"success",plain:"",icon:"Edit",disabled:a(Z),onClick:te},{default:o(()=>e[26]||(e[26]=[v("修改")])),_:1},8,["disabled"])),[[k,["system:user:edit"]]])]),_:1}),t(i,{span:1.5},{default:o(()=>[b((u(),d(_,{type:"danger",plain:"",icon:"Delete",disabled:a(ee),onClick:le},{default:o(()=>e[27]||(e[27]=[v("删除")])),_:1},8,["disabled"])),[[k,["system:user:remove"]]])]),_:1}),t(i,{span:1.5},{default:o(()=>[b((u(),d(_,{type:"info",plain:"",icon:"Upload",onClick:Re},{default:o(()=>e[28]||(e[28]=[v("导入")])),_:1})),[[k,["system:user:import"]]])]),_:1}),t(i,{span:1.5},{default:o(()=>[b((u(),d(_,{type:"warning",plain:"",icon:"Download",onClick:Ue},{default:o(()=>e[29]||(e[29]=[v("导出")])),_:1})),[[k,["system:user:export"]]])]),_:1}),t(Ke,{showSearch:a(B),"onUpdate:showSearch":e[5]||(e[5]=l=>K(B)?B.value=l:null),onQueryTable:I,columns:a(x)},null,8,["showSearch","columns"])]),_:1}),b((u(),d(Qe,{data:a(X),onSelectionChange:Fe},{default:o(()=>[t(h,{type:"selection",width:"50",align:"left"}),a(x)[0].visible?(u(),d(h,{label:"用户编号",align:"left",key:"userId",prop:"userId"})):y("",!0),a(x)[1].visible?(u(),d(h,{label:"登录账号",align:"left",key:"userName",prop:"userName","show-overflow-tooltip":!0})):y("",!0),a(x)[2].visible?(u(),d(h,{label:"用户昵称",align:"left",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):y("",!0),a(x)[3].visible?(u(),d(h,{label:"部门名称",align:"left",key:"deptName",prop:"dept.deptName","show-overflow-tooltip":!0})):y("",!0),a(x)[4].visible?(u(),d(h,{label:"手机号码",align:"left",key:"phone",prop:"phone",width:"120"})):y("",!0),a(x)[5].visible?(u(),d(h,{label:"状态",align:"left",key:"statusFlag"},{default:o(l=>{var T;return[(T=l.row.roleIds)!=null&&T.includes(a(q))?(u(),d(ze,{key:1,options:a(M),value:l.row.statusFlag},null,8,["options","value"])):b((u(),d(Me,{key:0,modelValue:l.row.statusFlag,"onUpdate:modelValue":$=>l.row.statusFlag=$,"active-value":"1","inactive-value":"0",onChange:$=>Ne(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])),[[k,["system:user:edit"]]])]}),_:1})):y("",!0),a(x)[6].visible?(u(),d(h,{key:6,label:"登录时间",align:"left",prop:"loginTime",width:"160"},{default:o(l=>[w("span",null,ge(n.parseTime(l.row.loginTime)),1)]),_:1})):y("",!0),t(h,{label:"操作",align:"left",width:"150","class-name":"small-padding fixed-width"},{default:o(l=>{var T,$,ne,se,ue,de,re,ie;return[($=(T=l.row)==null?void 0:T.roleIds)!=null&&$.includes(a(q))?y("",!0):(u(),d(O,{key:0,content:"修改",placement:"top"},{default:o(()=>[b(t(_,{link:"",type:"primary",icon:"Edit",onClick:W=>te(l.row)},null,8,["onClick"]),[[k,["system:user:edit"]]])]),_:2},1024)),(se=(ne=l.row)==null?void 0:ne.roleIds)!=null&&se.includes(a(q))?y("",!0):(u(),d(O,{key:1,content:"删除",placement:"top"},{default:o(()=>[b(t(_,{link:"",type:"primary",icon:"Delete",onClick:W=>le(l.row)},null,8,["onClick"]),[[k,["system:user:remove"]]])]),_:2},1024)),(de=(ue=l.row)==null?void 0:ue.roleIds)!=null&&de.includes(a(q))?y("",!0):(u(),d(O,{key:2,content:"重置密码",placement:"top"},{default:o(()=>[b(t(_,{link:"",type:"primary",icon:"Key",onClick:W=>Se(l.row)},null,8,["onClick"]),[[k,["system:user:resetPwd"]]])]),_:2},1024)),(ie=(re=l.row)==null?void 0:re.roleIds)!=null&&ie.includes(a(q))?y("",!0):(u(),d(O,{key:3,content:"解锁",placement:"top"},{default:o(()=>[b(t(_,{link:"",type:"primary",icon:"Unlock",onClick:W=>Ce(l.row.userName)},null,8,["onClick"]),[[k,["monitor:logininfor:unlock"]]])]),_:2},1024))]}),_:1})]),_:1},8,["data"])),[[el,a(z)]]),b(t(Ae,{total:a(A),page:a(m).pageNum,"onUpdate:page":e[6]||(e[6]=l=>a(m).pageNum=l),limit:a(m).pageSize,"onUpdate:limit":e[7]||(e[7]=l=>a(m).pageSize=l),onPagination:I},null,8,["total","page","limit"]),[[ce,a(A)>0]])]),_:1})]),_:1}),t(oe,{title:a(Y),modelValue:a(V),"onUpdate:modelValue":e[19]||(e[19]=l=>K(V)?V.value=l:null),width:"600px","append-to-body":""},{footer:o(()=>[w("div",Gl,[t(_,{type:"primary",onClick:Le},{default:o(()=>e[30]||(e[30]=[v("确 定")])),_:1}),t(_,{onClick:qe},{default:o(()=>e[31]||(e[31]=[v("取 消")])),_:1})])]),default:o(()=>[t(ae,{model:a(s),rules:a(we),ref:"userRef","label-width":"80px"},{default:o(()=>[t(U,null,{default:o(()=>[t(i,{span:12},{default:o(()=>[t(f,{label:"用户昵称",prop:"nickName"},{default:o(()=>[t(r,{modelValue:a(s).nickName,"onUpdate:modelValue":e[8]||(e[8]=l=>a(s).nickName=l),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{span:12},{default:o(()=>[t(f,{label:"归属部门",prop:"deptId"},{default:o(()=>[t(Ye,{modelValue:a(s).deptId,"onUpdate:modelValue":e[9]||(e[9]=l=>a(s).deptId=l),data:a(j),props:{value:"id",label:"label",children:"children"},"value-key":"id",placeholder:"请选择归属部门","check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),t(U,null,{default:o(()=>[t(i,{span:12},{default:o(()=>[t(f,{label:"手机号码",prop:"phone"},{default:o(()=>[t(r,{modelValue:a(s).phone,"onUpdate:modelValue":e[10]||(e[10]=l=>a(s).phone=l),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{span:12},{default:o(()=>[t(f,{label:"邮箱",prop:"email"},{default:o(()=>[t(r,{modelValue:a(s).email,"onUpdate:modelValue":e[11]||(e[11]=l=>a(s).email=l),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(U,null,{default:o(()=>[t(i,{span:12},{default:o(()=>[a(s).userId==null?(u(),d(f,{key:0,label:"登录账号",prop:"userName"},{default:o(()=>[t(r,{modelValue:a(s).userName,"onUpdate:modelValue":e[12]||(e[12]=l=>a(s).userName=l),placeholder:"请输入登录账号",maxlength:"30"},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1}),t(i,{span:12},{default:o(()=>[a(s).userId==null?(u(),d(f,{key:0,label:"用户密码",prop:"password"},{default:o(()=>[t(r,{modelValue:a(s).password,"onUpdate:modelValue":e[13]||(e[13]=l=>a(s).password=l),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1})]),_:1}),t(U,null,{default:o(()=>[t(i,{span:12},{default:o(()=>[t(f,{label:"用户性别"},{default:o(()=>[t(C,{modelValue:a(s).sex,"onUpdate:modelValue":e[14]||(e[14]=l=>a(s).sex=l),placeholder:"请选择"},{default:o(()=>[(u(!0),S(D,null,P(a(be),l=>(u(),d(N,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(i,{span:12},{default:o(()=>[t(f,{label:"状态"},{default:o(()=>[t(Ge,{modelValue:a(s).statusFlag,"onUpdate:modelValue":e[15]||(e[15]=l=>a(s).statusFlag=l)},{default:o(()=>[(u(!0),S(D,null,P(a(M),l=>(u(),d(je,{key:l.value,value:l.value},{default:o(()=>[v(ge(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(U,null,{default:o(()=>[t(i,{span:12},{default:o(()=>[t(f,{label:"岗位"},{default:o(()=>[t(C,{modelValue:a(s).postIds,"onUpdate:modelValue":e[16]||(e[16]=l=>a(s).postIds=l),multiple:"",placeholder:"请选择"},{default:o(()=>[(u(!0),S(D,null,P(a(G),l=>(u(),d(N,{key:l.postId,label:l.postName,value:l.postId,disabled:l.status==="0"},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(i,{span:12},{default:o(()=>[t(f,{label:"角色"},{default:o(()=>[t(C,{modelValue:a(s).roleIds,"onUpdate:modelValue":e[17]||(e[17]=l=>a(s).roleIds=l),multiple:"",placeholder:"请选择"},{default:o(()=>[(u(!0),S(D,null,P(a(H),l=>(u(),d(N,{key:l.roleId,label:l.roleName,value:l.roleId,disabled:l.status==="0"},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(U,null,{default:o(()=>[t(i,{span:24},{default:o(()=>[t(f,{label:"备注"},{default:o(()=>[t(r,{modelValue:a(s).remark,"onUpdate:modelValue":e[18]||(e[18]=l=>a(s).remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(oe,{title:a(c).title,modelValue:a(c).open,"onUpdate:modelValue":e[22]||(e[22]=l=>a(c).open=l),width:"400px","append-to-body":""},{footer:o(()=>[w("div",Wl,[t(_,{type:"primary",onClick:Pe},{default:o(()=>e[36]||(e[36]=[v("确 定")])),_:1}),t(_,{onClick:e[21]||(e[21]=l=>a(c).open=!1)},{default:o(()=>e[37]||(e[37]=[v("取 消")])),_:1})])]),default:o(()=>[t(Ze,{ref:"uploadRef",limit:1,accept:".xlsx, .xls","http-request":Ee,disabled:a(c).isUploading,"on-progress":$e,"auto-upload":!1,drag:""},{tip:o(()=>[w("div",Hl,[w("div",Jl,[t(We,{modelValue:a(c).updateSupport,"onUpdate:modelValue":e[20]||(e[20]=l=>a(c).updateSupport=l),disabled:a(c).isUploading},null,8,["modelValue","disabled"]),e[32]||(e[32]=v("是否更新已经存在的用户数据 "))]),e[34]||(e[34]=w("span",null,"仅允许导入xls、xlsx格式文件。",-1)),t(Xe,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},disabled:a(c).isUploading,onClick:Te},{default:o(()=>e[33]||(e[33]=[v("下载模板")])),_:1},8,["disabled"])])]),default:o(()=>[t(Je,{class:"el-icon--upload"},{default:o(()=>[t(He)]),_:1}),e[35]||(e[35]=w("div",{class:"el-upload__text"},[v("将文件拖到此处，或"),w("em",null,"点击上传")],-1))]),_:1},8,["disabled"])]),_:1},8,["title","modelValue"])])}}};export{yt as default};
