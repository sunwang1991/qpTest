import{ab as U,N as A,ac as E,D as C,ba as S,V as q,Q as j,au as x,a8 as P,R as H,d as p,bb as B,bc as D,bd as Q,be as $,aV as G,bf as J,a9 as W,bg as X,bh as Y,a7 as Z,r as z,I as L,O as ee,bi as T,az as le}from"./index-koRf1amC.js";import{E as w}from"./el-tree-GdsLcPzm.js";const te=(e,{attrs:c,emit:o},{select:r,tree:s,key:n})=>{const h=U("tree-select");return A(()=>e.data,()=>{e.filterable&&E(()=>{var l,v;(v=s.value)==null||v.filter((l=r.value)==null?void 0:l.states.inputValue)})},{flush:"post"}),{...S(q(e),Object.keys(j.props)),...c,class:C(()=>c.class),style:C(()=>c.style),"onUpdate:modelValue":l=>o(x,l),valueKey:n,popperClass:C(()=>{const l=[h.e("popper")];return e.popperClass&&l.push(e.popperClass),l.join(" ")}),filterMethod:(l="")=>{var v;e.filterMethod?e.filterMethod(l):e.remoteMethod?e.remoteMethod(l):(v=s.value)==null||v.filter(l)}}},ae=P({extends:H,setup(e,c){const o=H.setup(e,c);delete o.selectOptionClick;const r=p().proxy;return E(()=>{o.select.states.cachedOptions.get(r.value)||o.select.onOptionCreate(r)}),A(()=>c.attrs.visible,s=>{E(()=>{o.states.visible=s})},{immediate:!0}),o},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function I(e){return e||e===0}function R(e){return B(e)&&e.length}function g(e){return B(e)?e:I(e)?[e]:[]}function O(e,c,o,r,s){for(let n=0;n<e.length;n++){const h=e[n];if(c(h,n,e,s))return r?r(h,n,e,s):h;{const k=o(h);if(R(k)){const l=O(k,c,o,r,h);if(l)return l}}}}function M(e,c,o,r){for(let s=0;s<e.length;s++){const n=e[s];c(n,s,e,r);const h=o(n);R(h)&&M(h,c,o,n)}}const ce=(e,{attrs:c,slots:o,emit:r},{select:s,tree:n,key:h})=>{A(()=>e.modelValue,()=>{e.showCheckbox&&E(()=>{const t=n.value;t&&!D(t.getCheckedKeys(),g(e.modelValue))&&t.setCheckedKeys(g(e.modelValue))})},{immediate:!0,deep:!0});const k=C(()=>({value:h.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),l=(t,a)=>{var d;const u=k.value[t];return J(u)?u(a,(d=n.value)==null?void 0:d.getNode(l("value",a))):a[u]},v=g(e.modelValue).map(t=>O(e.data||[],a=>l("value",a)===t,a=>l("children",a),(a,d,u,f)=>f&&l("value",f))).filter(t=>I(t)),V=C(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return M(e.data.concat(e.cacheData),a=>{const d=l("value",a);t.push({value:d,currentLabel:l("label",a),isDisabled:l("disabled",a)})},a=>l("children",a)),t}),K=()=>{var t;return(t=n.value)==null?void 0:t.getCheckedKeys().filter(a=>{var d;const u=(d=n.value)==null?void 0:d.getNode(a);return!G(u)&&$(u.childNodes)})};return{...S(q(e),Object.keys(w.props)),...c,nodeKey:h,expandOnClickNode:C(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:C(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(v):v),renderContent:(t,{node:a,data:d,store:u})=>t(ae,{value:l("value",d),label:l("label",d),disabled:l("disabled",d),visible:a.visible},e.renderContent?()=>e.renderContent(t,{node:a,data:d,store:u}):o.default?()=>o.default({node:a,data:d,store:u}):void 0),filterNodeMethod:(t,a,d)=>e.filterNodeMethod?e.filterNodeMethod(t,a,d):t?new RegExp(Q(t),"i").test(l("label",a)||""):!0,onNodeClick:(t,a,d)=>{var u,f,b,m;if((u=c.onNodeClick)==null||u.call(c,t,a,d),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||a.isLeaf)){if(!l("disabled",t)){const N=(f=s.value)==null?void 0:f.states.options.get(l("value",t));(b=s.value)==null||b.handleOptionSelect(N)}}else e.expandOnClickNode&&d.proxy.handleExpandIconClick();(m=s.value)==null||m.focus()}},onCheck:(t,a)=>{var d;if(!e.showCheckbox)return;const u=l("value",t),f={};M([n.value.store.root],i=>f[i.key]=i,i=>i.childNodes);const b=a.checkedKeys,m=e.multiple?g(e.modelValue).filter(i=>!(i in f)&&!b.includes(i)):[],N=m.concat(b);if(e.checkStrictly)r(x,e.multiple?N:N.includes(u)?u:void 0);else if(e.multiple){const i=K();r(x,m.concat(i))}else{const i=O([t],y=>!R(l("children",y))&&!l("disabled",y),y=>l("children",y)),_=i?l("value",i):void 0,F=I(e.modelValue)&&!!O([t],y=>l("value",y)===e.modelValue,y=>l("children",y));r(x,_===e.modelValue||F?void 0:_)}E(()=>{var i;const _=g(e.modelValue);n.value.setCheckedKeys(_),(i=c.onCheck)==null||i.call(c,t,{checkedKeys:n.value.getCheckedKeys(),checkedNodes:n.value.getCheckedNodes(),halfCheckedKeys:n.value.getHalfCheckedKeys(),halfCheckedNodes:n.value.getHalfCheckedNodes()})}),(d=s.value)==null||d.focus()},onNodeExpand:(t,a,d)=>{var u;(u=c.onNodeExpand)==null||u.call(c,t,a,d),E(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&a.checked){const f={},b=n.value.getCheckedKeys();M([n.value.store.root],i=>f[i.key]=i,i=>i.childNodes);const m=g(e.modelValue).filter(i=>!(i in f)&&!b.includes(i)),N=K();r(x,m.concat(N))}})},cacheOptions:V}};var ne=P({props:{data:{type:Array,default:()=>[]}},setup(e){const c=W(X);return A(()=>e.data,()=>{var o;e.data.forEach(s=>{c.states.cachedOptions.has(s.value)||c.states.cachedOptions.set(s.value,s)});const r=((o=c.selectRef)==null?void 0:o.querySelectorAll("input"))||[];Y&&!Array.from(r).includes(document.activeElement)&&c.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const se=P({name:"ElTreeSelect",inheritAttrs:!1,props:{...j.props,...w.props,cacheData:{type:Array,default:()=>[]}},setup(e,c){const{slots:o,expose:r}=c,s=z(),n=z(),h=C(()=>e.nodeKey||e.valueKey||"value"),k=te(e,c,{select:s,tree:n,key:h}),{cacheOptions:l,...v}=ce(e,c,{select:s,tree:n,key:h}),V=L({});return r(V),ee(()=>{Object.assign(V,{...S(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...S(s.value,["focus","blur","selectedLabel"])})}),()=>T(j,L({...k,ref:K=>s.value=K}),{...o,default:()=>[T(ne,{data:l.value}),T(w,L({...v,ref:K=>n.value=K}))]})}});var de=Z(se,[["__file","tree-select.vue"]]);const ue=le(de);export{ue as E};
