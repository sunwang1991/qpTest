import{M as I,d as re,r as g,u as se,I as ie,V as pe,O as de,W as me,c as F,o as p,K as c,f as e,X as Q,k as a,w as l,E as fe,n as _e,Q as ge,S as z,T as K,i as v,R as be,J as R,q as ce,p as s,L as ve,h as G,t as w}from"./index-koRf1amC.js";/* empty css                   */import{E as we}from"./el-dialog-BKcY_UO0.js";import{_ as je}from"./index-CSO0AOC1.js";import{a as ye,E as he}from"./el-table-column-r1ysCLPE.js";import"./el-checkbox-HK0N5oFI.js";import{_ as Ee}from"./index-C7JIz0oM.js";import{E as Ve}from"./el-row-VKr6Yz4y.js";import{_ as ke}from"./index-CWBHHNWa.js";import{E as Ce}from"./el-col-BsYUv868.js";import{E as xe,a as Se}from"./el-form-item-BLvtEj0w.js";import{E as Ne}from"./el-date-picker-BzY-SmTT.js";import{g as Te}from"./job-CUB5if4b.js";import"./_baseClone-VCTtEV7x.js";import"./index-BaLWcWe0.js";function De(h){return I({url:"/monitor/job/log/list",method:"get",params:h})}function Fe(h){return I({url:`/monitor/job/log/${h}`,method:"delete"})}function Re(){return I({url:"/monitor/job/log/clean",method:"delete"})}const Ge={class:"app-container"},Ie={class:"dialog-footer"},Ze={__name:"log",setup(h){const{proxy:d}=re(),{sys_common_status:C,sys_job_group:x}=d.useDict("sys_common_status","sys_job_group"),L=g([]),j=g(!1),S=g(!0),E=g(!0),N=g([]),$=g(!0),T=g(0),y=g([]),U=se(),O=ie({form:{},queryParams:{pageNum:1,pageSize:20,jobName:"",jobGroup:"",statusFlag:void 0}}),{queryParams:u,form:m,rules:Le}=pe(O);function b(){S.value=!0,De(d.addDateRange(u.value,y.value)).then(n=>{L.value=n.data.rows,T.value=n.data.total,S.value=!1})}function W(){const n={path:"/monitor/job"};d.$tab.closeOpenPage(n)}function D(){u.value.pageNum=1,b()}function X(){y.value=[],d.resetForm("queryRef"),D()}function A(n){N.value=n.map(o=>o.logId),$.value=!n.length}function H(n){j.value=!0,m.value=n}function Y(n){d.$modal.confirm('是否确认删除调度日志编号为"'+N.value+'"的数据项?').then(function(){return Fe(N.value)}).then(()=>{b(),d.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Z(){d.$modal.confirm("是否确认清空所有调度日志数据项?").then(function(){return Re()}).then(()=>{b(),d.$modal.msgSuccess("清空成功")}).catch(()=>{})}function ee(){d.download("monitor/job/log/export",{...u.value},`job_log_${new Date().getTime()}.xlsx`)}return de(()=>{const n=U.params&&U.params.jobId;n!==void 0&&n!=0?Te(n).then(o=>{u.value.jobName=o.data.jobName,u.value.jobGroup=o.data.jobGroup}).finally(()=>{b()}):b()}),(n,o)=>{const P=fe,r=xe,q=be,B=ge,le=Ne,_=ce,J=Se,f=Ce,oe=ke,M=Ve,i=ye,V=Ee,te=he,ae=je,ne=we,k=me("hasPermi"),ue=ve;return p(),F("div",Ge,[c(e(J,{model:a(u),ref:"queryRef",inline:!0,"label-width":"68px"},{default:l(()=>[e(r,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(P,{modelValue:a(u).jobName,"onUpdate:modelValue":o[0]||(o[0]=t=>a(u).jobName=t),placeholder:"请输入任务名称",clearable:"",style:{width:"240px"},onKeyup:_e(D,["enter"])},null,8,["modelValue"])]),_:1}),e(r,{label:"任务组名",prop:"jobGroup"},{default:l(()=>[e(B,{modelValue:a(u).jobGroup,"onUpdate:modelValue":o[1]||(o[1]=t=>a(u).jobGroup=t),placeholder:"请选择任务组名",clearable:"",style:{width:"240px"}},{default:l(()=>[(p(!0),F(z,null,K(a(x),t=>(p(),v(q,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"执行状态",prop:"statusFlag"},{default:l(()=>[e(B,{modelValue:a(u).statusFlag,"onUpdate:modelValue":o[2]||(o[2]=t=>a(u).statusFlag=t),placeholder:"请选择执行状态",clearable:"",style:{width:"240px"}},{default:l(()=>[(p(!0),F(z,null,K(a(C),t=>(p(),v(q,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"记录时间",style:{width:"308px"}},{default:l(()=>[e(le,{modelValue:a(y),"onUpdate:modelValue":o[3]||(o[3]=t=>R(y)?y.value=t:null),type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),e(r,null,{default:l(()=>[e(_,{type:"primary",icon:"Search",onClick:D},{default:l(()=>o[9]||(o[9]=[s("搜索")])),_:1}),e(_,{icon:"Refresh",onClick:X},{default:l(()=>o[10]||(o[10]=[s("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[Q,a(E)]]),e(M,{gutter:10,class:"mb8"},{default:l(()=>[e(f,{span:1.5},{default:l(()=>[c((p(),v(_,{type:"danger",plain:"",icon:"Delete",disabled:a($),onClick:Y},{default:l(()=>o[11]||(o[11]=[s("删除")])),_:1},8,["disabled"])),[[k,["monitor:job:remove"]]])]),_:1}),e(f,{span:1.5},{default:l(()=>[c((p(),v(_,{type:"danger",plain:"",icon:"Delete",onClick:Z},{default:l(()=>o[12]||(o[12]=[s("清空")])),_:1})),[[k,["monitor:job:remove"]]])]),_:1}),e(f,{span:1.5},{default:l(()=>[c((p(),v(_,{type:"warning",plain:"",icon:"Download",onClick:ee},{default:l(()=>o[13]||(o[13]=[s("导出")])),_:1})),[[k,["monitor:job:export"]]])]),_:1}),e(f,{span:1.5},{default:l(()=>[e(_,{type:"warning",plain:"",icon:"Close",onClick:W},{default:l(()=>o[14]||(o[14]=[s("关闭")])),_:1})]),_:1}),e(oe,{showSearch:a(E),"onUpdate:showSearch":o[4]||(o[4]=t=>R(E)?E.value=t:null),onQueryTable:b},null,8,["showSearch"])]),_:1}),c((p(),v(te,{data:a(L),onSelectionChange:A},{default:l(()=>[e(i,{type:"selection",width:"55",align:"left"}),e(i,{label:"日志编号",width:"80",align:"left",prop:"logId"}),e(i,{label:"任务名称",align:"left",prop:"jobName","show-overflow-tooltip":!0}),e(i,{label:"任务组名",align:"left",prop:"jobGroup","show-overflow-tooltip":!0},{default:l(t=>[e(V,{options:a(x),value:t.row.jobGroup},null,8,["options","value"])]),_:1}),e(i,{label:"调用目标字符串",align:"left",prop:"invokeTarget","show-overflow-tooltip":!0}),e(i,{label:"日志信息",align:"left",prop:"jobMsg","show-overflow-tooltip":!0}),e(i,{label:"执行状态",align:"left",prop:"statusFlag"},{default:l(t=>[e(V,{options:a(C),value:t.row.statusFlag},null,8,["options","value"])]),_:1}),e(i,{label:"记录时间",align:"left",prop:"createTime",width:"180"},{default:l(t=>[G("span",null,w(n.parseTime(t.row.createTime)),1)]),_:1}),e(i,{label:"消耗时间",align:"left",prop:"costTime",width:"110","show-overflow-tooltip":!0,"sort-orders":["descending","ascending"]},{default:l(t=>[G("span",null,w(t.row.costTime)+" ms",1)]),_:1}),e(i,{label:"操作",align:"left","class-name":"small-padding fixed-width"},{default:l(t=>[c((p(),v(_,{link:"",type:"primary",icon:"View",onClick:$e=>H(t.row)},{default:l(()=>o[15]||(o[15]=[s("详细")])),_:2},1032,["onClick"])),[[k,["monitor:job:query"]]])]),_:1})]),_:1},8,["data"])),[[ue,a(S)]]),c(e(ae,{total:a(T),page:a(u).pageNum,"onUpdate:page":o[5]||(o[5]=t=>a(u).pageNum=t),limit:a(u).pageSize,"onUpdate:limit":o[6]||(o[6]=t=>a(u).pageSize=t),onPagination:b},null,8,["total","page","limit"]),[[Q,a(T)>0]]),e(ne,{title:"调度日志详细",modelValue:a(j),"onUpdate:modelValue":o[8]||(o[8]=t=>R(j)?j.value=t:null),width:"700px","append-to-body":""},{footer:l(()=>[G("div",Ie,[e(_,{onClick:o[7]||(o[7]=t=>j.value=!1)},{default:l(()=>o[16]||(o[16]=[s("关 闭")])),_:1})])]),default:l(()=>[e(J,{model:a(m),"label-width":"100px"},{default:l(()=>[e(M,null,{default:l(()=>[e(f,{span:12},{default:l(()=>[e(r,{label:"日志序号："},{default:l(()=>[s(w(a(m).logId),1)]),_:1}),e(r,{label:"任务名称："},{default:l(()=>[s(w(a(m).jobName),1)]),_:1})]),_:1}),e(f,{span:12},{default:l(()=>[e(r,{label:"任务分组："},{default:l(()=>[e(V,{options:a(x),value:a(m).jobGroup},null,8,["options","value"])]),_:1}),e(r,{label:"执行时间："},{default:l(()=>[s(w(n.parseTime(a(m).createTime)),1)]),_:1})]),_:1}),e(f,{span:24},{default:l(()=>[e(r,{label:"调用方法："},{default:l(()=>[s(w(a(m).invokeTarget),1)]),_:1})]),_:1}),e(f,{span:24},{default:l(()=>[e(r,{label:"日志信息："},{default:l(()=>[e(P,{type:"textarea",disabled:!0,rows:3,value:a(m).jobMsg},null,8,["value"])]),_:1})]),_:1}),e(f,{span:24},{default:l(()=>[e(r,{label:"执行状态："},{default:l(()=>[e(V,{options:a(C),value:a(m).statusFlag},null,8,["options","value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{Ze as default};
