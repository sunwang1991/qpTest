import{b as je,a as Ge,d as Je,r as d,I as We,V as Xe,e as Ze,W as el,c as O,o as i,K as y,f as t,X as Z,k as o,w as a,E as ll,n as ce,Q as tl,S as ee,T as le,i as c,R as ol,J as V,q as al,p as s,L as nl,aU as $,Y as ul,G as rl,h as Q,t as ve,j as z,Z as dl,$ as sl,ac as H,a0 as il}from"./index-G7k4jObO.js";/* empty css                   */import{E as ml}from"./el-dialog-DIYJXQiP.js";import{E as pl}from"./el-tree-B-MLhPxD.js";import{E as fl}from"./el-checkbox-BDHvdtX6.js";import{E as cl,b as vl}from"./el-radio-D3_6fv-a.js";import{E as yl}from"./el-input-number-BiqDyfz5.js";import{_ as gl}from"./index-lnQ7o6NH.js";import{a as kl,E as _l}from"./el-table-column-DdgShedu.js";import{E as bl}from"./el-row-ErebF3jE.js";import{_ as hl}from"./index-1r1_z5ZC.js";import{E as Cl}from"./el-col-B8uK4B1i.js";import{E as Vl,a as Sl}from"./el-form-item-BuGiXd-d.js";import{E as wl}from"./el-date-picker-BqAdHxwn.js";import{l as El,g as ye,e as Kl,f as xl,h as Nl,i as Il,j as Ul,k as Rl}from"./role-Bb5bpIV4.js";import{t as Tl,r as Dl}from"./menu-D28axYOJ.js";import"./index-BgiGdtQm.js";import"./_baseClone-BzXbRH51.js";const Fl={class:"app-container"},$l={class:"dialog-footer"},ql={class:"dialog-footer"},ot={__name:"index",setup(Ll){const Y=je(),ge=Ge(),{proxy:v}=Je(),{sys_normal_disable:te}=v.useDict("sys_normal_disable"),oe=d([]),g=d(!1),j=d(!0),q=d(!0),G=d([]),ae=d(!0),ne=d(!0),J=d(0),x=d(""),N=d([]),I=d([]),L=d(!1),U=d(!1),A=d(!1),R=d(!1),M=d([]),w=d(!1),k=d(null),_=d(null),ke=d([{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}]),_e=We({form:{},queryParams:{pageNum:1,pageSize:20,roleName:"",roleKey:"",statusFlag:void 0},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),{queryParams:p,form:u,rules:be}=Xe(_e);function b(){j.value=!0,El(v.addDateRange(p.value,N.value)).then(n=>{oe.value=n.data.rows,J.value=n.data.total,j.value=!1})}function P(){p.value.pageNum=1,b()}function he(){N.value=[],v.resetForm("queryRef"),P()}function ue(n){const e=n.roleId||G.value;v.$modal.confirm('是否确认删除角色编号为"'+e+'"的数据项?').then(function(){return Kl(e)}).then(()=>{b(),v.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Ce(){v.download("system/role/export",{...p.value},`role_${new Date().getTime()}.xlsx`)}function Ve(n){G.value=n.map(e=>e.roleId),ae.value=n.length!=1,ne.value=!n.length}function Se(n){let e=n.statusFlag=="1"?"启用":"停用";v.$modal.confirm('确认要"'+e+'""'+n.roleName+'"角色吗?').then(function(){return xl(n.roleId,n.statusFlag)}).then(()=>{v.$modal.msgSuccess(e+"成功")}).catch(function(){n.statusFlag=n.statusFlag=="0"?"1":"0"})}function we(n){ge.push({path:`/system/role${il}/auth-user/${n.roleId}`,query:{roleName:n.roleName}})}function Ee(){let n=_.value.getCheckedKeys(),e=_.value.getHalfCheckedKeys();return n.unshift.apply(n,e),n}function T(){k.value&&k.value.setCheckedKeys([]),L.value=!1,U.value=!1,A.value=!1,R.value=!1,u.value={roleId:void 0,roleName:"",roleKey:"",roleSort:0,statusFlag:"0",menuIds:[],deptIds:[],menuCheckStrictly:"1",deptCheckStrictly:"1",dataScope:"5",remark:""},v.resetForm("roleRef")}function Ke(){T(),Tl().then(n=>{I.value=n.data,g.value=!0,x.value="添加角色"})}function re(n){T();const e=n.roleId||G.value,m=xe(e);ye(e).then(r=>{u.value=r.data,u.value.roleSort=Number(u.value.roleSort),g.value=!0,H(()=>{m.then(S=>{let D=S.checkedKeys;D.forEach(W=>{H(()=>{k.value.setChecked(W,!0,!1)})}),U.value=D.length>0})}),x.value="修改角色"})}function xe(n){return Dl(n).then(e=>(I.value=e.data.menus,e.data))}function Ne(n){return Rl(n).then(e=>(M.value=e.data.depts,e.data))}function de(n,e){if(e=="menu"){let m=I.value;for(let r=0;r<m.length;r++)k.value.store.nodesMap[m[r].id].expanded=n}else if(e=="dept"){let m=M.value;for(let r=0;r<m.length;r++)_.value.store.nodesMap[m[r].id].expanded=n}}function se(n,e){e=="menu"?k.value.setCheckedNodes(n?I.value:[]):e=="dept"&&_.value.setCheckedNodes(n?M.value:[])}function ie(n,e){e=="menu"?u.value.menuCheckStrictly=n?"1":"0":e=="dept"&&(u.value.deptCheckStrictly=n?"1":"0")}function me(){let n=k.value.getCheckedKeys(),e=k.value.getHalfCheckedKeys();return n.unshift.apply(n,e),n}function Ie(){v.$refs.roleRef.validate(n=>{n&&(u.value.roleId?(u.value.menuIds=me(),Nl(u.value).then(e=>{v.$modal.msgSuccess("修改成功"),g.value=!1,b()})):(u.value.menuIds=me(),Il(u.value).then(e=>{v.$modal.msgSuccess("新增成功"),g.value=!1,b()})))})}function Ue(){g.value=!1,T()}function Re(n){n!=="2"&&_.value.setCheckedKeys([])}function Te(n){T();const e=Ne(n.roleId);ye(n.roleId).then(m=>{u.value=m.data,w.value=!0,H(()=>{e.then(r=>{const S=r.checkedKeys;H(()=>{_.value&&_.value.setCheckedKeys(S)}),R.value=S.length>0})}),x.value="分配数据权限"})}function De(){u.value.roleId&&(u.value.deptIds=Ee(),Ul(u.value).then(n=>{v.$modal.msgSuccess("修改成功"),w.value=!1,b()}))}function Fe(){w.value=!1,T()}return b(),(n,e)=>{const m=ll,r=Vl,S=ol,D=tl,W=wl,f=al,X=Sl,B=Cl,$e=hl,qe=bl,h=kl,Le=ul,Ae=rl,F=dl,Me=_l,Pe=gl,Be=Ze("question-filled"),Oe=sl,Qe=yl,ze=vl,He=cl,E=fl,pe=pl,fe=ml,C=el("hasPermi"),Ye=nl;return i(),O("div",Fl,[y(t(X,{model:o(p),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[t(r,{label:"角色名称",prop:"roleName"},{default:a(()=>[t(m,{modelValue:o(p).roleName,"onUpdate:modelValue":e[0]||(e[0]=l=>o(p).roleName=l),placeholder:"请输入角色名称",clearable:"",style:{width:"240px"},onKeyup:ce(P,["enter"])},null,8,["modelValue"])]),_:1}),t(r,{label:"角色键值",prop:"roleKey"},{default:a(()=>[t(m,{modelValue:o(p).roleKey,"onUpdate:modelValue":e[1]||(e[1]=l=>o(p).roleKey=l),placeholder:"请输入角色键值",clearable:"",style:{width:"240px"},onKeyup:ce(P,["enter"])},null,8,["modelValue"])]),_:1}),t(r,{label:"角色状态",prop:"statusFlag"},{default:a(()=>[t(D,{modelValue:o(p).statusFlag,"onUpdate:modelValue":e[2]||(e[2]=l=>o(p).statusFlag=l),placeholder:"角色状态",clearable:"",style:{width:"240px"}},{default:a(()=>[(i(!0),O(ee,null,le(o(te),l=>(i(),c(S,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"创建时间",style:{width:"308px"}},{default:a(()=>[t(W,{modelValue:o(N),"onUpdate:modelValue":e[3]||(e[3]=l=>V(N)?N.value=l:null),type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),t(r,null,{default:a(()=>[t(f,{type:"primary",icon:"Search",onClick:P},{default:a(()=>e[27]||(e[27]=[s("搜索")])),_:1}),t(f,{icon:"Refresh",onClick:he},{default:a(()=>e[28]||(e[28]=[s("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[Z,o(q)]]),t(qe,{gutter:10,class:"mb8"},{default:a(()=>[t(B,{span:1.5},{default:a(()=>[y((i(),c(f,{type:"primary",plain:"",icon:"Plus",onClick:Ke},{default:a(()=>e[29]||(e[29]=[s("新增")])),_:1})),[[C,["system:role:add"]]])]),_:1}),t(B,{span:1.5},{default:a(()=>[y((i(),c(f,{type:"success",plain:"",icon:"Edit",disabled:o(ae),onClick:re},{default:a(()=>e[30]||(e[30]=[s("修改")])),_:1},8,["disabled"])),[[C,["system:role:edit"]]])]),_:1}),t(B,{span:1.5},{default:a(()=>[y((i(),c(f,{type:"danger",plain:"",icon:"Delete",disabled:o(ne),onClick:ue},{default:a(()=>e[31]||(e[31]=[s("删除")])),_:1},8,["disabled"])),[[C,["system:role:remove"]]])]),_:1}),t(B,{span:1.5},{default:a(()=>[y((i(),c(f,{type:"warning",plain:"",icon:"Download",onClick:Ce},{default:a(()=>e[32]||(e[32]=[s("导出")])),_:1})),[[C,["system:role:export"]]])]),_:1}),t($e,{showSearch:o(q),"onUpdate:showSearch":e[4]||(e[4]=l=>V(q)?q.value=l:null),onQueryTable:b},null,8,["showSearch"])]),_:1}),y((i(),c(Me,{data:o(oe),onSelectionChange:Ve},{default:a(()=>[t(h,{type:"selection",width:"55",align:"left"}),t(h,{label:"角色编号",prop:"roleId",width:"120"}),t(h,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0,width:"150"}),t(h,{label:"角色键值",prop:"roleKey","show-overflow-tooltip":!0,width:"150"}),t(h,{label:"显示顺序",prop:"roleSort",width:"100"}),t(h,{label:"角色状态",align:"left",width:"100"},{default:a(l=>[l.row.roleId!==o($)&&!o(Y).roles.includes(l.row.roleKey)?(i(),c(Le,{key:0,modelValue:l.row.statusFlag,"onUpdate:modelValue":K=>l.row.statusFlag=K,"active-value":"1","inactive-value":"0",onChange:K=>Se(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(i(),c(Ae,{key:1},{default:a(()=>e[33]||(e[33]=[s("启用")])),_:1}))]),_:1}),t(h,{label:"创建时间",align:"left",prop:"createTime"},{default:a(l=>[Q("span",null,ve(n.parseTime(l.row.createTime)),1)]),_:1}),t(h,{label:"操作",align:"left","class-name":"small-padding fixed-width"},{default:a(l=>[l.row.roleId!==o($)&&!o(Y).roles.includes(l.row.roleKey)?(i(),c(F,{key:0,content:"修改",placement:"top"},{default:a(()=>[y(t(f,{link:"",type:"primary",icon:"Edit",onClick:K=>re(l.row)},null,8,["onClick"]),[[C,["system:role:edit"]]])]),_:2},1024)):z("",!0),l.row.roleId!==o($)&&!o(Y).roles.includes(l.row.roleKey)?(i(),c(F,{key:1,content:"删除",placement:"top"},{default:a(()=>[y(t(f,{link:"",type:"primary",icon:"Delete",onClick:K=>ue(l.row)},null,8,["onClick"]),[[C,["system:role:remove"]]])]),_:2},1024)):z("",!0),l.row.roleId!==o($)?(i(),c(F,{key:2,content:"数据权限",placement:"top"},{default:a(()=>[y(t(f,{link:"",type:"primary",icon:"CircleCheck",onClick:K=>Te(l.row)},null,8,["onClick"]),[[C,["system:role:edit"]]])]),_:2},1024)):z("",!0),l.row.roleId!==o($)?(i(),c(F,{key:3,content:"分配用户",placement:"top"},{default:a(()=>[y(t(f,{link:"",type:"primary",icon:"User",onClick:K=>we(l.row)},null,8,["onClick"]),[[C,["system:role:edit"]]])]),_:2},1024)):z("",!0)]),_:1})]),_:1},8,["data"])),[[Ye,o(j)]]),y(t(Pe,{total:o(J),page:o(p).pageNum,"onUpdate:page":e[5]||(e[5]=l=>o(p).pageNum=l),limit:o(p).pageSize,"onUpdate:limit":e[6]||(e[6]=l=>o(p).pageSize=l),onPagination:b},null,8,["total","page","limit"]),[[Z,o(J)>0]]),t(fe,{title:o(x),modelValue:o(g),"onUpdate:modelValue":e[17]||(e[17]=l=>V(g)?g.value=l:null),width:"500px","append-to-body":""},{footer:a(()=>[Q("div",$l,[t(f,{type:"primary",onClick:Ie},{default:a(()=>e[38]||(e[38]=[s("确 定")])),_:1}),t(f,{onClick:Ue},{default:a(()=>e[39]||(e[39]=[s("取 消")])),_:1})])]),default:a(()=>[t(X,{ref:"roleRef",model:o(u),rules:o(be),"label-width":"100px"},{default:a(()=>[t(r,{label:"角色名称",prop:"roleName"},{default:a(()=>[t(m,{modelValue:o(u).roleName,"onUpdate:modelValue":e[7]||(e[7]=l=>o(u).roleName=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(r,{prop:"roleKey"},{label:a(()=>[Q("span",null,[t(F,{content:"控制器中定义的权限字符，如：dba",placement:"top"},{default:a(()=>[t(Oe,null,{default:a(()=>[t(Be)]),_:1})]),_:1}),e[34]||(e[34]=s(" 权限字符 "))])]),default:a(()=>[t(m,{modelValue:o(u).roleKey,"onUpdate:modelValue":e[8]||(e[8]=l=>o(u).roleKey=l),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1}),t(r,{label:"角色顺序",prop:"roleSort"},{default:a(()=>[t(Qe,{modelValue:o(u).roleSort,"onUpdate:modelValue":e[9]||(e[9]=l=>o(u).roleSort=l),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),t(r,{label:"状态"},{default:a(()=>[t(He,{modelValue:o(u).statusFlag,"onUpdate:modelValue":e[10]||(e[10]=l=>o(u).statusFlag=l)},{default:a(()=>[(i(!0),O(ee,null,le(o(te),l=>(i(),c(ze,{key:l.value,value:l.value},{default:a(()=>[s(ve(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"菜单权限"},{default:a(()=>[t(E,{modelValue:o(L),"onUpdate:modelValue":e[11]||(e[11]=l=>V(L)?L.value=l:null),onChange:e[12]||(e[12]=l=>de(l,"menu"))},{default:a(()=>e[35]||(e[35]=[s(" 展开/折叠 ")])),_:1},8,["modelValue"]),t(E,{modelValue:o(U),"onUpdate:modelValue":e[13]||(e[13]=l=>V(U)?U.value=l:null),onChange:e[14]||(e[14]=l=>se(l,"menu"))},{default:a(()=>e[36]||(e[36]=[s(" 全选/全不选 ")])),_:1},8,["modelValue"]),t(E,{checked:o(u).menuCheckStrictly==="1",onChange:e[15]||(e[15]=l=>ie(l,"menu"))},{default:a(()=>e[37]||(e[37]=[s(" 父子联动 ")])),_:1},8,["checked"]),t(pe,{class:"tree-border",data:o(I),"show-checkbox":"",ref_key:"menuRef",ref:k,"node-key":"id","check-strictly":o(u).menuCheckStrictly==="0","empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(r,{label:"备注"},{default:a(()=>[t(m,{modelValue:o(u).remark,"onUpdate:modelValue":e[16]||(e[16]=l=>o(u).remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(fe,{title:o(x),modelValue:o(w),"onUpdate:modelValue":e[26]||(e[26]=l=>V(w)?w.value=l:null),width:"500px","append-to-body":""},{footer:a(()=>[Q("div",ql,[t(f,{type:"primary",onClick:De},{default:a(()=>e[43]||(e[43]=[s("确 定")])),_:1}),t(f,{onClick:Fe},{default:a(()=>e[44]||(e[44]=[s("取 消")])),_:1})])]),default:a(()=>[t(X,{model:o(u),"label-width":"80px"},{default:a(()=>[t(r,{label:"角色名称"},{default:a(()=>[t(m,{modelValue:o(u).roleName,"onUpdate:modelValue":e[18]||(e[18]=l=>o(u).roleName=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(r,{label:"权限字符"},{default:a(()=>[t(m,{modelValue:o(u).roleKey,"onUpdate:modelValue":e[19]||(e[19]=l=>o(u).roleKey=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(r,{label:"权限范围"},{default:a(()=>[t(D,{modelValue:o(u).dataScope,"onUpdate:modelValue":e[20]||(e[20]=l=>o(u).dataScope=l),onChange:Re},{default:a(()=>[(i(!0),O(ee,null,le(o(ke),l=>(i(),c(S,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),y(t(r,{label:"数据权限"},{default:a(()=>[t(E,{modelValue:o(A),"onUpdate:modelValue":e[21]||(e[21]=l=>V(A)?A.value=l:null),onChange:e[22]||(e[22]=l=>de(l,"dept"))},{default:a(()=>e[40]||(e[40]=[s(" 展开/折叠 ")])),_:1},8,["modelValue"]),t(E,{modelValue:o(R),"onUpdate:modelValue":e[23]||(e[23]=l=>V(R)?R.value=l:null),onChange:e[24]||(e[24]=l=>se(l,"dept"))},{default:a(()=>e[41]||(e[41]=[s(" 全选/全不选 ")])),_:1},8,["modelValue"]),t(E,{checked:o(u).deptCheckStrictly==="1",onChange:e[25]||(e[25]=l=>ie(l,"dept"))},{default:a(()=>e[42]||(e[42]=[s(" 父子联动 ")])),_:1},8,["checked"]),t(pe,{class:"tree-border",data:o(M),"show-checkbox":"",ref_key:"deptRef",ref:_,"node-key":"id","check-strictly":o(u).deptCheckStrictly==="0","empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1},512),[[Z,o(u).dataScope==2]])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}};export{ot as default};
