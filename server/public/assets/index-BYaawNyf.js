import{M as J,d as ne,r as g,I as re,V as se,W as ue,c as U,o as f,K as b,f as e,X as K,k as t,w as l,E as pe,n as O,Q as de,S as Q,T as z,i as v,R as ie,J as R,q as me,p,L as fe,h as L,t as d}from"./index-G7k4jObO.js";/* empty css                   */import{E as _e}from"./el-dialog-DIYJXQiP.js";import{_ as ge}from"./index-lnQ7o6NH.js";import{a as ce,E as ye}from"./el-table-column-DdgShedu.js";import"./el-checkbox-BDHvdtX6.js";import{_ as be}from"./index-MQ6fygIi.js";import{E as ve}from"./el-row-ErebF3jE.js";import{_ as we}from"./index-1r1_z5ZC.js";import{E as he}from"./el-col-B8uK4B1i.js";import{E as Ve,a as xe}from"./el-form-item-BuGiXd-d.js";import{E as Ee}from"./el-date-picker-BqAdHxwn.js";import"./_baseClone-BzXbRH51.js";import"./index-BgiGdtQm.js";function Te(N){return J({url:"/system/log/operate/list",method:"get",params:N})}function Se(){return J({url:"/system/log/operate/clean",method:"delete"})}const ke={class:"app-container"},Ce={class:"dialog-footer"},ze={__name:"index",setup(N){const{proxy:_}=ne(),{sys_opera_type:E,sys_common_status:T}=_.useDict("sys_opera_type","sys_common_status"),P=g([]),w=g(!1),S=g(!0),x=g(!0),k=g(0),h=g([]),C=g({prop:"operaTime",order:"descending"}),W=re({form:{},queryParams:{pageNum:1,pageSize:20,title:void 0,operaBy:void 0,businessType:void 0,statusFlag:void 0,sortBy:void 0,sortOrder:void 0}}),{queryParams:n,form:s}=se(W);function c(){S.value=!0,Te(_.addDateRange(n.value,h.value)).then(u=>{P.value=u.data.rows,k.value=u.data.total,S.value=!1})}function X(u,o){return _.selectDictLabel(E.value,u.businessType)}function B(){n.value.pageNum=1,c()}function j(){h.value=[],_.resetForm("queryRef"),n.value.pageNum=1,_.$refs.operlogRef.sort(C.value.prop,C.value.order)}function A(u,o,V){n.value.sortBy=u.prop,n.value.sortOrder=u.order,c()}function G(u){w.value=!0,s.value=u}function H(){_.$modal.confirm("是否确认清空所有操作日志数据项?").then(function(){return Se()}).then(()=>{c(),_.$modal.msgSuccess("清空成功")}).catch(()=>{})}function Y(){_.download("/system/log/operate/export",{...n.value},`operate_log_${new Date().getTime()}.xlsx`)}return c(),(u,o)=>{const V=pe,r=Ve,q=ie,I=de,Z=Ee,y=me,$=xe,i=he,ee=we,M=ve,m=ce,D=be,le=ye,te=ge,ae=_e,F=ue("hasPermi"),oe=fe;return f(),U("div",ke,[b(e($,{model:t(n),ref:"queryRef",inline:!0,"label-width":"68px"},{default:l(()=>[e(r,{label:"操作模块",prop:"title"},{default:l(()=>[e(V,{modelValue:t(n).title,"onUpdate:modelValue":o[0]||(o[0]=a=>t(n).title=a),placeholder:"请输入操作模块",clearable:"",style:{width:"240px"},onKeyup:O(B,["enter"])},null,8,["modelValue"])]),_:1}),e(r,{label:"操作人员",prop:"operaBy"},{default:l(()=>[e(V,{modelValue:t(n).operaBy,"onUpdate:modelValue":o[1]||(o[1]=a=>t(n).operaBy=a),placeholder:"请输入操作人员",clearable:"",style:{width:"240px"},onKeyup:O(B,["enter"])},null,8,["modelValue"])]),_:1}),e(r,{label:"操作类型",prop:"businessType"},{default:l(()=>[e(I,{modelValue:t(n).businessType,"onUpdate:modelValue":o[2]||(o[2]=a=>t(n).businessType=a),placeholder:"操作类型",clearable:"",style:{width:"240px"}},{default:l(()=>[(f(!0),U(Q,null,z(t(E),a=>(f(),v(q,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"操作状态",prop:"statusFlag"},{default:l(()=>[e(I,{modelValue:t(n).statusFlag,"onUpdate:modelValue":o[3]||(o[3]=a=>t(n).statusFlag=a),placeholder:"操作状态",clearable:"",style:{width:"240px"}},{default:l(()=>[(f(!0),U(Q,null,z(t(T),a=>(f(),v(q,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"操作时间",style:{width:"308px"}},{default:l(()=>[e(Z,{modelValue:t(h),"onUpdate:modelValue":o[4]||(o[4]=a=>R(h)?h.value=a:null),type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),e(r,null,{default:l(()=>[e(y,{type:"primary",icon:"Search",onClick:B},{default:l(()=>o[10]||(o[10]=[p("搜索")])),_:1}),e(y,{icon:"Refresh",onClick:j},{default:l(()=>o[11]||(o[11]=[p("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[K,t(x)]]),e(M,{gutter:10,class:"mb8"},{default:l(()=>[e(i,{span:1.5},{default:l(()=>[b((f(),v(y,{type:"danger",plain:"",icon:"Delete",onClick:H},{default:l(()=>o[12]||(o[12]=[p(" 清空 ")])),_:1})),[[F,["system:log:operate:remove"]]])]),_:1}),e(i,{span:1.5},{default:l(()=>[b((f(),v(y,{type:"warning",plain:"",icon:"Download",onClick:Y},{default:l(()=>o[13]||(o[13]=[p(" 导出 ")])),_:1})),[[F,["system:log:operate:export"]]])]),_:1}),e(ee,{showSearch:t(x),"onUpdate:showSearch":o[5]||(o[5]=a=>R(x)?x.value=a:null),onQueryTable:c},null,8,["showSearch"])]),_:1}),b((f(),v(le,{ref:"operlogRef",data:t(P),"default-sort":t(C),onSortChange:A},{default:l(()=>[e(m,{label:"日志编号",align:"left",prop:"id"}),e(m,{label:"模块名称",align:"left",prop:"title","show-overflow-tooltip":!0}),e(m,{label:"业务类型",align:"left",prop:"businessType"},{default:l(a=>[e(D,{options:t(E),value:a.row.businessType},null,8,["options","value"])]),_:1}),e(m,{label:"操作人员",align:"left",width:"110",prop:"operaBy","show-overflow-tooltip":!0,sortable:"custom","sort-orders":["descending","ascending"]}),e(m,{label:"请求方式",align:"left",prop:"operaUrlMethod",width:"100"}),e(m,{label:"请求主机",align:"left",prop:"operaIp",width:"130","show-overflow-tooltip":!0}),e(m,{label:"操作状态",align:"left",prop:"statusFlag"},{default:l(a=>[e(D,{options:t(T),value:a.row.statusFlag},null,8,["options","value"])]),_:1}),e(m,{label:"操作日期",align:"left",prop:"operaTime",width:"180",sortable:"custom","sort-orders":["descending","ascending"]},{default:l(a=>[L("span",null,d(u.parseTime(a.row.operaTime)),1)]),_:1}),e(m,{label:"消耗时间",align:"left",prop:"costTime",width:"110","show-overflow-tooltip":!0,sortable:"custom","sort-orders":["descending","ascending"]},{default:l(a=>[L("span",null,d(a.row.costTime)+" ms",1)]),_:1}),e(m,{label:"操作",align:"left","class-name":"small-padding fixed-width"},{default:l(a=>[b((f(),v(y,{link:"",type:"primary",icon:"View",onClick:Be=>G(a.row,a.index)},{default:l(()=>o[14]||(o[14]=[p(" 详细 ")])),_:2},1032,["onClick"])),[[F,["system:log:operate:query"]]])]),_:1})]),_:1},8,["data","default-sort"])),[[oe,t(S)]]),b(e(te,{total:t(k),page:t(n).pageNum,"onUpdate:page":o[6]||(o[6]=a=>t(n).pageNum=a),limit:t(n).pageSize,"onUpdate:limit":o[7]||(o[7]=a=>t(n).pageSize=a),onPagination:c},null,8,["total","page","limit"]),[[K,t(k)>0]]),e(ae,{title:"操作日志详细",modelValue:t(w),"onUpdate:modelValue":o[9]||(o[9]=a=>R(w)?w.value=a:null),width:"700px","append-to-body":""},{footer:l(()=>[L("div",Ce,[e(y,{onClick:o[8]||(o[8]=a=>w.value=!1)},{default:l(()=>o[15]||(o[15]=[p("关 闭")])),_:1})])]),default:l(()=>[e($,{model:t(s),"label-width":"100px"},{default:l(()=>[e(M,null,{default:l(()=>[e(i,{span:12},{default:l(()=>[e(r,{label:"操作模块："},{default:l(()=>[p(d(t(s).title)+" / "+d(X(t(s))),1)]),_:1}),e(r,{label:"登录信息："},{default:l(()=>[p(d(t(s).operaBy)+" / "+d(t(s).operaIp)+" / "+d(t(s).operaLocation),1)]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(r,{label:"请求方式："},{default:l(()=>[p(d(t(s).operaUrlMethod),1)]),_:1})]),_:1}),e(i,{span:24},{default:l(()=>[e(r,{label:"请求地址："},{default:l(()=>[p(d(t(s).operaUrl),1)]),_:1})]),_:1}),e(i,{span:24},{default:l(()=>[e(r,{label:"操作方法："},{default:l(()=>[p(d(t(s).operaMethod),1)]),_:1})]),_:1}),e(i,{span:24},{default:l(()=>[e(r,{label:"请求参数："},{default:l(()=>[e(V,{disabled:"",rows:3,type:"textarea",placeholder:"请求参数",value:t(s).operaParam},null,8,["value"])]),_:1})]),_:1}),e(i,{span:24},{default:l(()=>[e(r,{label:"操作信息："},{default:l(()=>[e(V,{disabled:"",rows:3,type:"textarea",placeholder:"操作信息",value:t(s).operaMsg},null,8,["value"])]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(r,{label:"操作状态："},{default:l(()=>[e(D,{options:t(T),value:t(s).statusFlag},null,8,["options","value"])]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(r,{label:"操作时间："},{default:l(()=>[p(d(u.parseTime(t(s).operaTime)),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{ze as default};
